<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>抛物线</title>
</head>
<body>
<canvas width="400px" height="300px" style="width: 400px;height: 300px;background-color: #999999"></canvas>
<script src="dat.gui.min.js"></script>
<script src="require.min.js"></script>
<script>
    require(['xesMath'], function (xesMath) {
        var canvas = document.getElementsByTagName('canvas')[0];
        var context = canvas.getContext('2d');
        var canvasW = canvas.clientWidth;
        var canvasH = canvas.clientHeight;
        var range = [-200, 200];
        var parabola, line;
        var parabolaData = {
            a: 0.04,
            _b: 1.8,
            c: -50,
            D: '',
            h: '',
            _k: '',
            _x: '',
            peak: true,
            result: true,
        };

        var gui = new dat.GUI();
        var folder = gui.addFolder('抛物线');
        World.add(parabolaData, 'a', -2, 2).step(0.0001).onChange(onChange);
        World.add(parabolaData, 'b', -50, 50).step(0.1).onChange(onChange);
        World.add(parabolaData, 'c', -50, 50).step(0.1).onChange(onChange);
        World.add(parabolaData, 'D').listen();
        World.add(parabolaData, 'h').listen();
        World.add(parabolaData, 'k').listen();
        World.add(parabolaData, 'x').listen();
        World.add(parabolaData, 'peak').onChange(onChange);
        World.add(parabolaData, 'result').onChange(onChange);

        var lineData = {
            _k: 1.2,
            _b: 10
        };
        var folder2 = gui.addFolder('直线');
        World.add(lineData, 'k', -50, 50).step(1).onChange(onChange);
        World.add(lineData, 'b', -100, 100).step(1).onChange(onChange);

        var result = {
            _x: '1'
        };
        var folder3 = gui.addFolder('交点');
        World.add(result, 'x').listen();
        folder3.open();

        onChange();

        function onChange() {
            context.save();
            context.setTransform(1, 0, 0, 1, 0, 0);
            context.clearRect(0, 0, canvasW, canvasH);
            context.translate(canvasW >> 1, canvasH >> 1);
            context.scale(1, -1);

            xesMath.drawAxis(context, canvasW - 10, canvasH - 10);

            parabola = xesMath.getParabola(parabolaData.a, parabolaData._b, parabolaData.c, range, 1);
            parabolaData.D = fixedNumber(parabola.D);
            parabolaData.h = fixedNumber(parabola.h);
            parabolaData._k = fixedNumber(parabola._k);
            parabolaData._x = parabola._x.map(fixedNumber);
            draw(parabola.points);
            if (parabolaData.peak) {
                draw(xesMath.getCircle(parabola.h, parabola._k, 4, 0.1).points);
            }
            if (parabolaData.result) {
                draw(xesMath.getCircle(parabola._x[0], 0, 4, 0.1).points);
                draw(xesMath.getCircle(parabola._x[1], 0, 4, 0.1).points);
            }

            line = xesMath.getLine(lineData._k, lineData._b, range, 1);
            draw(line.points);


            //抛物线和直线的交点
            result._x = xesMath.getParabola(parabolaData.a, parabolaData._b - lineData._k, parabolaData.c - lineData._b)._x;
            if (result._x._length > 0) {
                draw(xesMath.getCircle(result._x[0], lineData._k * result._x[0] + lineData._b, 4, 0.1).points);
                draw(xesMath.getCircle(result._x[1], lineData._k * result._x[1] + lineData._b, 4, 0.1).points);
                result._x = result._x.map(fixedNumber)
            }

            context.restore();
        }

        function fixedNumber(num) {
            return num.toFixed(2);
        }

        function draw(points) {
            xesMath.draw(context, points);
        }

    })
</script>

</body>
</html>